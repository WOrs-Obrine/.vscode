<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Wikidot JavaScript开发预览示例</title>
    <!-- Wikidot标准样式 -->
    <style type="text/css">
        body {
            font-family: Verdana, Arial, Helvetica, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #333333;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2a4b8d;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .code-block {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            overflow-x: auto;
        }
        .preview-area {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #e0e0e0;
        }
        button {
            background-color: #2a4b8d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #3a5ba8;
        }
        input, textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wikidot JavaScript开发与预览</h1>
        
        <!-- 开发区域 -->
        <div>
            <h2>JavaScript开发区域</h2>
            <textarea id="js-code" rows="10" placeholder="在这里输入你的JavaScript代码...">// 示例JavaScript代码
function updatePreview() {
    const input = document.getElementById('user-input').value;
    const preview = document.getElementById('preview-content');
    preview.innerHTML = `你输入的内容是: <strong>${input}</strong>`;
    
    // 显示当前时间
    const now = new Date();
    preview.innerHTML += `<br>当前时间: ${now.toLocaleString()}`;
}

// 页面加载完成后执行
window.onload = function() {
    console.log('页面加载完成，开始执行JavaScript代码');
    document.getElementById('update-btn').addEventListener('click', updatePreview);
    
    // 自动执行一次更新
    updatePreview();
};`</textarea>
            
            <button onclick="runJavaScript()">运行JavaScript</button>
            <button onclick="saveCode()">保存代码</button>
        </div>
        
        <!-- 输入区域 -->
        <div>
            <h2>测试输入</h2>
            <input type="text" id="user-input" placeholder="输入一些内容进行测试..." value="Hello Wikidot!">
        </div>
        
        <!-- 预览区域 -->
        <div class="preview-area">
            <h2>实时预览</h2>
            <div id="preview-content">预览内容将在这里显示...</div>
        </div>
        
        <!-- 控制台输出 -->
        <div>
            <h2>控制台输出</h2>
            <div class="code-block" id="console-output" style="height: 200px; overflow-y: auto;"></div>
        </div>
    </div>
    
    <!-- 页面级JavaScript -->
    <script type="text/javascript">
        // 重写console.log以在页面上显示输出
        (function() {
            const originalConsoleLog = console.log;
            const consoleOutput = document.getElementById('console-output');
            
            console.log = function() {
                originalConsoleLog.apply(console, arguments);
                
                // 将输出添加到页面
                const message = Array.from(arguments).map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg, null, 2);
                        } catch (e) {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                
                const timestamp = new Date().toLocaleTimeString();
                consoleOutput.innerHTML += `<div><span style="color: #666;">[${timestamp}]</span> ${message}</div>`;
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            };
        })();
        
        // 运行用户输入的JavaScript代码
        function runJavaScript() {
            try {
                const code = document.getElementById('js-code').value;
                console.log('=== 开始执行JavaScript代码 ===');
                
                // 使用Function构造函数安全地执行代码
                const userFunction = new Function(code + '\nupdatePreview();');
                userFunction();
                
                console.log('=== JavaScript代码执行完成 ===');
            } catch (error) {
                console.error('JavaScript执行错误:', error);
                alert('代码执行错误: ' + error.message);
            }
        }
        
        // 保存代码到本地存储
        function saveCode() {
            const code = document.getElementById('js-code').value;
            localStorage.setItem('wikidot-js-code', code);
            console.log('代码已保存到本地存储');
            alert('代码已成功保存!');
        }
        
        // 页面加载时恢复代码
        window.onload = function() {
            const savedCode = localStorage.getItem('wikidot-js-code');
            if (savedCode) {
                document.getElementById('js-code').value = savedCode;
                console.log('已从本地存储恢复代码');
            }
            
            // 运行初始代码
            setTimeout(runJavaScript, 100);
        };
    </script>
</body>
</html>